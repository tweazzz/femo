<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/dist/style.css" rel="stylesheet" />
    <script defer src="src/scripts/showpass.js"></script>
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link rel="icon" href="/src/assets/images/cube.png" type="image/png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@25.12.5/build/css/intlTelInput.css">
  </head>
<style>
  .iti--fullscreen-popup.iti--container {
    top: -300px !important;
    left: 470px !important;
  }
/* –ø–æ–º–µ—Å—Ç–∏—Ç–µ –≤ <style> (–∏–ª–∏ –≤ –≤–∞—à css) */
.iti--container {
  position: relative !important;
  display: inline-block !important;
  width: auto !important;
  box-sizing: border-box;
}

.iti__country-list {
  position: block !important;
  top: calc(100% + 6px) !important;
  left: 0 !important;
  width: auto !important;
  min-width: 220px !important;
  max-width: 380px !important;
  box-sizing: border-box !important;
  z-index: 9999 !important;
  max-height: 250px !important;
  overflow-y: auto !important;
}

.iti__country-list .iti__country {
  white-space: nowrap !important;
}
</style>
  <body class="bg-gray-background">
    <div class="mx-auto my-8 max-w-lg rounded-3xl bg-white p-5 shadow-md">

      <div class="mb-2 text-center text-2xl font-bold">
        <p>–†–∞—Å—Å–∫–∞–∂–∏ –Ω–µ–º–Ω–æ–≥–æ –æ —Å–µ–±–µ üëã</p>
      </div>

      <div class="text-primary mb-6 rounded-lg text-center text-sm">
        –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–¥–æ–±—Ä–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è —Ç–≤–æ–µ–≥–æ —É—Ä–æ–≤–Ω—è
      </div>

      <form class="space-y-6">
        <br>
        <div>
            <label for="city" class="text-gray-primary mb-1 block text-sm">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–≤</label>
            <input
              type="text"
              id="city"
              name="city"
              placeholder="–ê–ª–º–∞—Ç—ã"
              class="input-base border-default w-full rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-400"
            />
        </div>
        <div>
          <label class="text-gray-primary mb-1 block text-sm">–ù–∞–∑–≤–∞–Ω–∏–µ —à–∫–æ–ª—ã</label>
          <input name="school"
            placeholder="–û–±—â–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è —à–∫–æ–ª–∞ ‚Ññ16 –∏–º. –ê. –®–∞—Ä–∏–ø–æ–≤–∞"
            class="input-base border-default"
          />
        </div>
        <div>
            <label for="grade" class="text-gray-primary mb-1 block text-sm">–ö–ª–∞—Å—Å</label>
            <select
              id="grade"
              name="grade"
              class="input-base border-default w-full rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-400"
            >
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
              <option value="11">11</option>
            </select>
        </div>

                    
        <div>
          <label class="text-gray-primary mb-1 block text-sm">–§–ò–û —Ä–æ–¥–∏—Ç–µ–ª—è</label>
          <input
            type="text" name="full_name"
            placeholder="–ê–π–∂–∞–Ω –ê—Ö–º–µ—Ç–æ–≤–∞"
            class="input-base border-default"
          />
        </div>
      <div>
          <label class="text-gray-primary mb-1 block text-sm">–¢–µ–ª–µ—Ñ–æ–Ω —Ä–æ–¥–∏—Ç–µ–ª—è</label>
          <input id="parent_phone" type="tel" name="parent_phone" class="input-base border-default w-full">
      </div>

        
        <!-- –§–ò–û —É—á–∏—Ç–µ–ª—è -->
        <div>
            <label class="text-gray-primary mb-1 block text-sm">–§–ò–û —É—á–∏—Ç–µ–ª—è</label>
            <input
            type="text"
            name="teacher_full_name"
            placeholder="–ì—É–ª—å–º–∏—Ä–∞ –ê–±–¥—Ä–∞—Ö–º–∞–Ω–æ–≤–∞"
            class="input-base border-default"
            />
        </div>
        
        <!-- –¢–µ–ª–µ—Ñ–æ–Ω –∏ Email —É—á–∏—Ç–µ–ª—è –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É -->
        <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
            <label class="text-gray-primary mb-1 block text-sm">–¢–µ–ª–µ—Ñ–æ–Ω —É—á–∏—Ç–µ–ª—è</label>
            <input id="teacher_phone" type="tel" name="teacher_phone" class="input-base border-default w-full">
        </div>

        
            <div class="flex-1">
            <label class="text-gray-primary mb-1 block text-sm">Email —É—á–∏—Ç–µ–ª—è</label>
            <input
                type="email"
                name="teacher_email"
                placeholder="teacher@example.com"
                class="input-base border-default w-full"
            />
            </div>
        </div>
  

        <button
          type="submit"
          class="bg-orange-primary w-full cursor-pointer rounded-xl py-2 text-white transition"
        >
            –ù–∞—á–∞—Ç—å —É—á–∏—Ç—å—Å—è
        </button>

      </form>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@25.12.5/build/js/intlTelInput.min.js"></script>
    <script>
      const input = document.querySelector("#phone");
      window.intlTelInput(input, {
        loadUtils: () => import("https://cdn.jsdelivr.net/npm/intl-tel-input@25.12.5/build/js/utils.js"),
      });
    </script>

  </body>
</html>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const phoneInputs = [
    document.querySelector("#parent_phone"),
    document.querySelector("#teacher_phone")
  ].filter(Boolean);

  if (!phoneInputs.length) return;

  // –∫–∞—Ä—Ç–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –¥–ª–∏–Ω –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ (–ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ —Ä–∞—Å—à–∏—Ä–∏–º)
  const nationalLengths = {
    kz: 10, // Kazakhstan (+7) ‚Äî 10 —Ü–∏—Ñ—Ä –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏
    ru: 10, // Russia (+7)
    kg: 9,  // Kyrgyzstan (+996)
    uz: 9,  // Uzbekistan (+998) ‚Äî –æ–±—ã—á–Ω–æ 9
    tr: 10  // Turkey (+90)
  };

  phoneInputs.forEach(input => {
    // —É–±–∏—Ä–∞–µ–º placeholder, —á—Ç–æ–±—ã –ø–ª–∞–≥–∏–Ω —Å–∞–º —É—Å—Ç–∞–Ω–æ–≤–∏–ª country-specific placeholder
    input.removeAttribute('placeholder');
    input.setAttribute('inputmode', 'tel');
    input.setAttribute('autocomplete', 'tel');

    const iti = window.intlTelInput(input, {
      initialCountry: "auto",
      separateDialCode: true,           // –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∫–æ–¥ —Å–ª–µ–≤–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
      preferredCountries: ["kz","ru","kg","uz","tr"],
      geoIpLookup: (success) => {
        fetch("https://ipapi.co/json/")
          .then(res => res.json())
          .then(data => success((data && data.country_code) ? data.country_code.toLowerCase() : 'kz'))
          .catch(() => success('kz'));
      },

      /* –ø–æ–¥–≥—Ä—É–∂–∞–µ–º utils –∫–∞–∫ –º–æ–¥—É–ª—å ‚Äî –Ω—É–∂–Ω–æ –¥–ª—è placeholder/formatting/validation */
      loadUtils: () => import("https://cdn.jsdelivr.net/npm/intl-tel-input@25.12.5/build/js/utils.js"),

      dropdownContainer: document.wrapper,  // —Ä–µ–Ω–¥–µ—Ä–∏–º –≤ body ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å layout
      autoPlaceholder: "aggressive",     // –ø–ª–∞–≥–∏–Ω –≤—ã—Å—Ç–∞–≤–∏—Ç –ø—Ä–∏–º–µ—Ä –Ω–æ–º–µ—Ä–∞ –∫–∞–∫ placeholder
      placeholderNumberType: "MOBILE",
      formatOnDisplay: true,
      formatAsYouType: true,             // —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –Ω–∞–±–æ—Ä–µ (—Ç—Ä–µ–±—É–µ—Ç utils)
      strictMode: true,                  // –∑–∞–ø—Ä–µ—â–∞–µ—Ç –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã –∏ –æ–±—Ä–µ–∑–∞–µ—Ç –¥–æ max
      nationalMode: true,                // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç (placeholder –±—É–¥–µ—Ç –∫–∞–∫ (777) ...)
      validationNumberTypes: ["MOBILE"], // –≤–∞–ª–∏–¥–∏—Ä—É–µ–º –∫–∞–∫ –º–æ–±–∏–ª—å–Ω—ã–µ (–ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é)
      allowDropdown: true
    });

    // –∫–æ–≥–¥–∞ utils –∑–∞–≥—Ä—É–∂–µ–Ω ‚Äî –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    if (iti && iti.promise) {
      iti.promise.then(() => {
        // –æ–±–Ω–æ–≤–ª—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –≤ dataset (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ fallback)
        const country = iti.getSelectedCountryData();
        const iso2 = (country && country.iso2) ? country.iso2.toLowerCase() : '';
        const maxDigits = nationalLengths[iso2] || 15;
        input.dataset.maxDigits = String(maxDigits);
      }).catch(()=>{ /* ignore */ });
    }

    // –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω—ã ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º –æ–∂–∏–¥–∞–µ–º—É—é –¥–ª–∏–Ω—É (–∏ placeholder –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
    input.addEventListener('countrychange', () => {
      const country = iti.getSelectedCountryData();
      const iso2 = (country && country.iso2) ? country.iso2.toLowerCase() : '';
      input.dataset.maxDigits = String(nationalLengths[iso2] || 15);

      // –µ—Å–ª–∏ utils –∑–∞–≥—Ä—É–∂–µ–Ω, –ø–æ–¥–ø—Ä–∞–≤–∏–º —Ñ–æ—Ä–º–∞—Ç (setNumber –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç —Ñ–æ—Ä–º–∞—Ç)
      try {
        const current = input.value.replace(/\D/g, '');
        if (current) {
          // —É—Å—Ç–∞–Ω–æ–≤–∏–º –∑–∞–Ω–æ–≤–æ, —á—Ç–æ–±—ã –ø–ª–∞–≥–∏–Ω –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–ª –ø–æ –Ω–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–µ
          iti.setNumber(current);
        }
      } catch (e) {}
    });

    // input: –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã (–ø–ª–∞–≥–∏–Ω —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) –∏ –Ω–µ –¥–∞—ë–º —Å–≤–µ—Ä—Ö–¥–ª–∏–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    input.addEventListener('input', (e) => {
      // –µ—Å–ª–∏ strictMode + utils –ø–æ–¥–∫–ª—é—á—ë–Ω ‚Äî –ø–ª–∞–≥–∏–Ω —É–∂–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
      const maxDigits = Number(input.dataset.maxDigits || 15);
      const digits = (input.value || '').replace(/\D/g, '').slice(0, maxDigits);
      // –≤ —Ä–µ–∂–∏–º–µ separateDialCode –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–ø—É—Ç–∞ ‚Äî –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å; —É—Å—Ç–∞–Ω–æ–≤–∏–º –µ—ë –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π
      try {
        // —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ –ø–ª–∞–≥–∏–Ω, —á—Ç–æ–±—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–∏–ª–æ—Å—å
        iti.setNumber(digits);
      } catch (err) {
        // fallback: –ø—Ä–æ—Å—Ç–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º —Ü–∏—Ñ—Ä—ã
        input.value = digits;
      }
      input.classList.remove('input-invalid');
    });

    // blur: –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    input.addEventListener('blur', () => {
      let valid = false;
      try {
        valid = iti.isValidNumber();
      } catch (err) {
        // fallback: –ø—Ä–æ—Å—Ç–∞—è –¥–ª–∏–Ω–∞
        const digits = (input.value || '').replace(/\D/g, '');
        const maxDigits = Number(input.dataset.maxDigits || 15);
        valid = digits.length === maxDigits || digits.length >= Math.max(6, Math.floor(maxDigits * 0.8));
      }
      if (!valid && input.value.trim() !== '') {
        input.classList.add('input-invalid');
      } else {
        input.classList.remove('input-invalid');
      }
    });

    // –µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –∫–ª–∏–∫–∞–µ—Ç –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É ‚Äî dropdown position –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω –ø–ª–∞–≥–∏–Ω–æ–º;
    // –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö ‚Äî –ø–ª–∞–≥–∏–Ω —Å–∞–º –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç fullscreen popup; –ø–æ—ç—Ç–æ–º—É –Ω–µ —Ç—Ä–æ–≥–∞–µ–º —ç—Ç–æ.
  });
});
</script>



<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('form');
  if (!form) return;

  // --- –±–∞–Ω–Ω–µ—Ä—ã —É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞ ---
  const successBanner = document.createElement('div');
  successBanner.setAttribute('aria-live', 'polite');
  successBanner.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-md bg-green-100 text-green-800 shadow-md flex items-center gap-3 text-sm font-semibold -translate-y-6 opacity-0 pointer-events-none transition-all duration-300';
  successBanner.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.707a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
    </svg>
    <span class="success-text"></span>
  `;
  document.body.insertBefore(successBanner, document.body.firstChild);

  const errorBanner = document.createElement('div');
  errorBanner.setAttribute('aria-live', 'polite');
  errorBanner.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-md bg-red-100 text-red-800 shadow-md flex items-center gap-3 text-sm font-semibold -translate-y-6 opacity-0 pointer-events-none transition-all duration-300';
  errorBanner.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
      <path d="M8.257 3.099c.765-1.36 2.72-1.36 3.485 0l5.454 9.69A1.75 1.75 0 0116.996 15H3.004a1.75 1.75 0 01-1.2-2.211l5.453-9.69zM11 13a1 1 0 10-2 0 1 1 0 002 0zm-1-3V6h0v4z"/>
    </svg>
    <span class="error-text"></span>
  `;
  document.body.insertBefore(errorBanner, successBanner.nextSibling);

  function showSuccess(text = '', ms = 1700) {
    successBanner.querySelector('.success-text').textContent = text;
    successBanner.classList.remove('-translate-y-6','opacity-0','pointer-events-none');
    successBanner.classList.add('translate-y-0','opacity-100','pointer-events-auto');
    clearTimeout(successBanner._hideTimeout);
    successBanner._hideTimeout = setTimeout(() => {
      successBanner.classList.remove('translate-y-0','opacity-100','pointer-events-auto');
      successBanner.classList.add('-translate-y-6','opacity-0','pointer-events-none');
    }, ms);
  }

  function showError(text = '', ms = 4000) {
    errorBanner.querySelector('.error-text').textContent = text;
    errorBanner.classList.remove('-translate-y-6','opacity-0','pointer-events-none');
    errorBanner.classList.add('translate-y-0','opacity-100','pointer-events-auto');
    clearTimeout(errorBanner._hideTimeout);
    errorBanner._hideTimeout = setTimeout(() => {
      errorBanner.classList.remove('translate-y-0','opacity-100','pointer-events-auto');
      errorBanner.classList.add('-translate-y-6','opacity-0','pointer-events-none');
    }, ms);
  }

  // –ü—Ä–æ—Å—Ç–∞—è —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è RU -> EN (fallback –¥–ª—è name_en)
  function translitRuToEn(str) {
    if (!str) return '';
    const map = {
      '–ê':'A','–ë':'B','–í':'V','–ì':'G','–î':'D','–ï':'E','–Å':'E','–ñ':'Zh','–ó':'Z','–ò':'I','–ô':'Y','–ö':'K','–õ':'L','–ú':'M','–ù':'N','–û':'O','–ü':'P','–†':'R','–°':'S','–¢':'T','–£':'U','–§':'F','–•':'Kh','–¶':'Ts','–ß':'Ch','–®':'Sh','–©':'Shch','–™':'','–´':'Y','–¨':'','–≠':'E','–Æ':'Yu','–Ø':'Ya',
      '–∞':'a','–±':'b','–≤':'v','–≥':'g','–¥':'d','–µ':'e','—ë':'e','–∂':'zh','–∑':'z','–∏':'i','–π':'y','–∫':'k','–ª':'l','–º':'m','–Ω':'n','–æ':'o','–ø':'p','—Ä':'r','—Å':'s','—Ç':'t','—É':'u','—Ñ':'f','—Ö':'kh','—Ü':'ts','—á':'ch','—à':'sh','—â':'shch','—ä':'','—ã':'y','—å':'','—ç':'e','—é':'yu','—è':'ya'
    };
    return String(str).split('').map(c => map[c] !== undefined ? map[c] : c).join('');
  }

  const gradeMap = {
    '1': 'first','2': 'second','3': 'third','4': 'fourth','5': 'fifth',
    '6': 'sixth','7': 'seventh','8': 'eighth','9': 'ninth','10': 'tenth','11': 'eleventh'
  };

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = form.querySelector('button[type="submit"]');
    let origText = '';
    if (submitBtn) {
      origText = submitBtn.innerText;
      submitBtn.disabled = true;
      submitBtn.innerText = '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º...';
    }

    try {
      // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã (–ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª–µ–π –∏–∑ —Ç–≤–æ–µ–≥–æ HTML)
      const city = (form.elements['city']?.value || '').trim();
      const school = (form.elements['school']?.value || '').trim();
      const gradeValue = (form.elements['grade']?.value || '').trim();
      const langChecked = form.querySelector('input[name="lang"]:checked');
      const studyLanguage = (langChecked?.value || 'ru').trim();

      const parent_name_ru = (form.elements['full_name']?.value || '').trim(); // —Ä–æ–¥–∏—Ç–µ–ª—å
      // –ø–æ–ª—É—á–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä intl-tel-input –∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º E.164 (—Å –∫–æ–¥–æ–º), —É–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–µ—Ü–∏—Ñ—Ä–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ –≤–µ–¥—É—â–µ–≥–æ '+'
      let parent_phone = '';
      try {
        const parentInst = window.intlTelInput && window.intlTelInput.getInstance
          ? window.intlTelInput.getInstance(document.querySelector('#parent_phone'))
          : null;
        parent_phone = parentInst ? (parentInst.getNumber() || '') : (form.elements['parent_phone']?.value || '');
        // –æ—á–∏—Å—Ç–∫–∞: –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ –≤–µ–¥—É—â–∏–π '+'
        parent_phone = parent_phone.replace(/[^\d+]/g, '');
      } catch (e) {
        // fallback ‚Äî –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—ã (–±–µ–∑ +)
        parent_phone = (form.elements['parent_phone']?.value || '').replace(/\D/g, '');
      }

      const teacher_name_ru = (form.elements['teacher_full_name']?.value || '').trim();
      // –¥–ª—è —É—á–∏—Ç–µ–ª—è —Ç–æ –∂–µ —Å–∞–º–æ–µ
      let teacher_phone = '';
      try {
        const teacherInst = window.intlTelInput && window.intlTelInput.getInstance
          ? window.intlTelInput.getInstance(document.querySelector('#teacher_phone'))
          : null;
        teacher_phone = teacherInst ? (teacherInst.getNumber() || '') : (form.elements['teacher_phone']?.value || '');
        teacher_phone = teacher_phone.replace(/[^\d+]/g, '');
      } catch (e) {
        teacher_phone = (form.elements['teacher_phone']?.value || '').replace(/\D/g, '');
      }
      // teacher_email –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —Ñ–æ—Ä–º–µ, –Ω–æ API –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –µ–≥–æ –≤ payload; —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
      const teacher_email = (form.elements['teacher_email']?.value || '').trim();

      // –î–æ—Å—Ç–∞—ë–º pending –¥–∞–Ω–Ω—ã–µ –∏–∑ sessionStorage (–ø–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –∏—Ö –ø–æ–ª–æ–∂–∏—Ç—å)
      let pending = {};
      try {
        const raw = sessionStorage.getItem('pending_registration') || localStorage.getItem('pending_participant');
        pending = raw ? JSON.parse(raw) : {};
      } catch (err) {
        console.warn('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è pending_registration:', err);
        pending = {};
      }

      const email = (pending.email || '').trim();
      const password = (sessionStorage.getItem('pending_password') || '').trim();
      const full_name_ru = (pending.full_name_ru || '').trim();
      const country = (pending.country || '').trim();

      // –í–∞–ª–∏–¥–∞—Ü–∏—è
      if (!email) { showError('–ù–µ –Ω–∞–π–¥–µ–Ω email –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (pending_registration).'); throw new Error('validation'); }
      if (!password) { showError('–ù–µ –Ω–∞–π–¥–µ–Ω –ø–∞—Ä–æ–ª—å (sessionStorage.pending_password).'); throw new Error('validation'); }
      if (!full_name_ru) { showError('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –§–ò–û –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (pending_registration.full_name_ru).'); throw new Error('validation'); }
      if (!country) { showError('–ù–µ –∑–∞–¥–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ (pending_registration.country).'); throw new Error('validation'); }

      if (!city) { showError('–£–∫–∞–∂–∏—Ç–µ –≥–æ—Ä–æ–¥.'); throw new Error('validation'); }
      if (!school) { showError('–£–∫–∞–∂–∏—Ç–µ —à–∫–æ–ª—É.'); throw new Error('validation'); }
      if (!gradeValue) { showError('–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å.'); throw new Error('validation'); }
      if (!parent_name_ru) { showError('–£–∫–∞–∂–∏—Ç–µ –§–ò–û —Ä–æ–¥–∏—Ç–µ–ª—è.'); throw new Error('validation'); }
      if (!parent_phone) { showError('–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω —Ä–æ–¥–∏—Ç–µ–ª—è.'); throw new Error('validation'); }
      if (!teacher_name_ru) { showError('–£–∫–∞–∂–∏—Ç–µ –§–ò–û —É—á–∏—Ç–µ–ª—è.'); throw new Error('validation'); }
      if (!teacher_phone) { showError('–£–∫–∞–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω —É—á–∏—Ç–µ–ª—è.'); throw new Error('validation'); }

      const grade = gradeMap[gradeValue] || gradeValue;

      // payload –≤ —Ñ–æ—Ä–º–∞—Ç–µ API
      const payload = {
        email,
        password,
        full_name_ru,
        full_name_en: translitRuToEn(full_name_ru),
        study_language: studyLanguage,
        country,
        city,
        school,
        grade,
        parent: {
          name_ru: parent_name_ru,
          name_en: translitRuToEn(parent_name_ru),
          phone_number: parent_phone
        },
        teacher: {
          name_ru: teacher_name_ru,
          name_en: translitRuToEn(teacher_name_ru),
          phone_number: teacher_phone
        }
      };

      // –û—Ç–ø—Ä–∞–≤–∫–∞ POST (–±–µ–∑ Authorization)
      const url = 'https://portal.femo.kz/api/users/participant/registration/';
      const resp = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      let respJson = null;
      try { respJson = await resp.clone().json(); } catch (e) { respJson = null; }

      if (resp.ok) {
        // —á–∏—Å—Ç–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        try {
          sessionStorage.removeItem('pending_registration');
          sessionStorage.removeItem('pending_password');
          localStorage.removeItem('pending_participant');
        } catch (e) {}

        showSuccess('–ü—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º...', 1500);
        setTimeout(() => { window.location.href = '/participant/reg_success.html'; }, 1200);
        return;
      } else {
        // —Ñ–æ—Ä–º–∏—Ä—É–µ–º —á–∏—Ç–∞–±–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        let errText = `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${resp.status}`;
        if (respJson) {
          if (respJson.detail) errText = String(respJson.detail);
          else if (respJson.code) errText = String(respJson.code);
          else {
            // –ø–µ—Ä–µ—á–∏—Å–ª–∏–º –ø–æ–ª—è –æ—à–∏–±–∫–∏
            const parts = [];
            for (const k in respJson) {
              const v = respJson[k];
              if (Array.isArray(v)) parts.push(`${k}: ${v.join(', ')}`);
              else if (typeof v === 'object') parts.push(`${k}: ${JSON.stringify(v)}`);
              else parts.push(`${k}: ${String(v)}`);
            }
            if (parts.length) errText = parts.join('\n');
            else errText = String(respJson);
          }
        }
        showError(errText);
        console.error('participant registration failed', resp.status, respJson);
      }

    } catch (err) {
      if (err && err.message === 'validation') {
        // vlaidation ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ –ø–æ–∫–∞–∑–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      } else {
        console.error('submit handler error', err);
        showError('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.');
      }
    } finally {
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.innerText = origText || '–ù–∞—á–∞—Ç—å —É—á–∏—Ç—å—Å—è';
      }
    }
  });
});
</script>






